<?phpif (!isset($_GET["sid"])) return;if (!isset($_GET["tid"])) return;if (!isset($_GET["g"])) return;if (!isset($_GET["n"])) return;$sid = $_GET["sid"];$tid = $_GET["tid"];$g = $_GET["g"];$n = $_GET["n"];if ($g < 0 || $g > 200 || !is_numeric($g)){	print("Invalid grade. Try again");	return;}$cn = mysqli_connect("localhost","loginid","loginpw") or die(mysqli_error());mysqli_select_db($cn,"dbname");switch ($n){	case 0:		$s = "insert into grades values(".$sid.",".$tid.",".$g.")";		$sm = "t_ok_1";		break;			case 1:		$s = "update grades set grade=".$g." where studid=".$sid." and itemid=".$tid;		$sm = "t_ok_2";		break;			case 2:		$sm = "t_ok_3";		$s="delete from grades where studid=".$sid." and itemid=".$tid;		break;}$r = mysqli_query($cn,$s);if (!$r)	print("SAVE FAILED. TRY AGAIN.");else	updateAutoScores($sid,$cn,$sm);mysqli_close($cn);function updateAutoScores($lid,$cn,$sm){	$r = mysqli_query($cn,"SELECT AVG(GRADE) AS A FROM GRADES WHERE (ITEMID BETWEEN 101 AND 200) AND STUDID = " . $lid);    $a = mysqli_fetch_array($r);	if ($a["A"])		$v = $a["A"];	else		$v = 0;		    mysqli_query($cn,"UPDATE STUDENTS SET ASSIGNMENT = " . $v. " WHERE STUDID = " . $lid);        $r = mysqli_query($cn,"SELECT AVG(GRADE) AS Q FROM GRADES WHERE (ITEMID BETWEEN 1 AND 100) AND STUDID = " . $lid);	$a = mysqli_fetch_array($r);		if ($a["Q"])		$v = $a["Q"];	else		$v = 0;	    mysqli_query($cn,"UPDATE STUDENTS SET QUIZ = ".$v." WHERE STUDID = " . $lid);        $r = mysqli_query($cn,"SELECT COUNT(GRADE) AS Q FROM GRADES WHERE (ITEMID BETWEEN 1 AND 100) AND STUDID = ".$lid);	$a = mysqli_fetch_array($r);	if ($a["Q"])		$v = $a["Q"];	else		$v = 0;	    mysqli_query($cn,"UPDATE STUDENTS SET QUIZCOUNT = ".$v." WHERE STUDID = ".$lid);        $r = mysqli_query($cn,"SELECT AVG(GRADE) AS FE FROM GRADES WHERE (ITEMID BETWEEN 201 AND 300) AND STUDID = " . $lid);	$a = mysqli_fetch_array($r);	if ($a["FE"])		$v = $a["FE"];	else		$v = 0;    mysqli_query($cn,"UPDATE STUDENTS SET FINALEXAM = ".$v." WHERE STUDID = " . $lid);        $r = mysqli_query($cn,"SELECT COUNT(GRADE) AS FE FROM GRADES WHERE (ITEMID BETWEEN 201 AND 300) AND STUDID = " . $lid);	$a = mysqli_fetch_array($r);	if ($a["FE"])		$v = $a["FE"];	else		$v = 0;    mysqli_query($cn,"UPDATE STUDENTS SET FECOUNT = ".$v." WHERE STUDID = " . $lid);        $r = mysqli_query($cn,"SELECT AVG(GRADE) AS D FROM GRADES WHERE (ITEMID BETWEEN 301 AND 400) AND STUDID = " . $lid);	$a = mysqli_fetch_array($r);	if ($a["D"])		$v = $a["D"];	else		$v = 0;    mysqli_query($cn,"UPDATE STUDENTS SET DEPORTMENT = ".$v." WHERE STUDID = " . $lid);        $r = mysqli_query($cn,"UPDATE STUDENTS SET FINALGRADE = (DEPORTMENT*0.05) + (ASSIGNMENT*0.05) + (QUIZ*0.4) +(FINALEXAM*0.5) WHERE STUDID = " . $lid);    	if ($r) 		print($sm);	else 		print("SAVE FAILED. TRY AGAIN.");		}?>